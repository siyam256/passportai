<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passport AI | External Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; min-height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; padding: 20px; }
        .app-container { background: white; border-radius: 24px; width: 100%; max-width: 380px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); overflow: hidden; position: relative; }
        .upload-box { border: 2px dashed #cbd5e1; border-radius: 16px; background: #f8fafc; transition: all 0.3s; height: 180px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .upload-box:hover { border-color: #0f172a; background: #fff; }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #fff; border-radius: 50%; width: 16px; height: 16px; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal { display: none; position: absolute; inset: 0; background: rgba(255,255,255,0.95); z-index: 50; padding: 30px; }
        .modal.active { display: flex; flex-direction: column; }
    </style>
</head>
<body>

    <div class="app-container p-8">
        <!-- Settings Toggle -->
        <button onclick="toggleSettings()" class="absolute top-6 right-6 text-slate-400 hover:text-slate-900 transition-colors">
            <i class="fas fa-cog text-lg"></i>
        </button>

        <!-- API Settings Modal -->
        <div id="settings-modal" class="modal">
            <h2 class="text-lg font-bold mb-2">API Settings</h2>
            <p class="text-xs text-slate-500 mb-6">Enter your Google AI Studio key to use this app in your browser.</p>
            <input type="password" id="api-key-input" placeholder="Paste AIZA... key here" class="w-full p-3 border rounded-xl mb-4 text-sm outline-none focus:ring-2 focus:ring-slate-900">
            <button onclick="saveSettings()" class="w-full py-3 bg-slate-900 text-white rounded-xl text-xs font-bold uppercase tracking-widest">Save Key</button>
            <button onclick="toggleSettings()" class="w-full mt-2 py-3 text-slate-400 text-[10px] font-bold uppercase">Cancel</button>
        </div>

        <div class="flex items-center gap-3 mb-8">
            <div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white"><i class="fas fa-camera"></i></div>
            <h1 class="text-xl font-extrabold tracking-tight">Passport AI</h1>
        </div>

        <div id="upload-zone" class="upload-box mb-6 relative group">
            <input type="file" id="file-input" class="hidden" accept="image/*">
            <div id="placeholder" class="text-center">
                <i class="fas fa-plus text-slate-300 text-2xl mb-2"></i>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Upload Photo</p>
            </div>
            <img id="preview-img" class="hidden absolute inset-0 w-full h-full object-cover rounded-[14px]">
        </div>

        <button id="create-btn" class="w-full py-4 bg-slate-900 text-white rounded-2xl text-[11px] font-bold uppercase tracking-[0.2em] transition-all hover:opacity-90 disabled:opacity-50">
            <span id="btn-text">Generate Passport Photo</span>
        </button>

        <div id="result-area" class="hidden mt-8 pt-8 border-t border-slate-100">
            <div class="flex flex-col items-center mb-6">
                <img id="output-img" class="w-40 h-40 object-cover rounded-lg shadow-xl border-4 border-white">
                <p class="mt-3 text-[9px] font-bold text-slate-400 uppercase tracking-widest">Standard 2x2 Format</p>
            </div>
            <div class="flex gap-2">
                <button id="save-btn" class="flex-1 py-4 bg-emerald-600 text-white rounded-xl text-[10px] font-bold uppercase tracking-wider">Download</button>
                <button onclick="window.location.reload()" class="px-5 bg-slate-100 rounded-xl border border-slate-200"><i class="fas fa-redo-alt text-slate-400"></i></button>
            </div>
        </div>

        <p id="status" class="hidden mt-4 p-3 rounded-lg text-[10px] font-bold text-center uppercase tracking-tight"></p>
    </div>

    <script>
        let storedKey = localStorage.getItem('passport_ai_key') || "";
        const modelName = "gemini-2.5-flash-image-preview";

        const fileInput = document.getElementById('file-input');
        const uploadZone = document.getElementById('upload-zone');
        const previewImg = document.getElementById('preview-img');
        const createBtn = document.getElementById('create-btn');
        const status = document.getElementById('status');

        function toggleSettings() { document.getElementById('settings-modal').classList.toggle('active'); }
        function saveSettings() {
            const key = document.getElementById('api-key-input').value.trim();
            if (key) { localStorage.setItem('passport_ai_key', key); storedKey = key; toggleSettings(); showStatus("Key saved!", false); }
        }

        uploadZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                previewImg.src = ev.target.result;
                previewImg.classList.remove('hidden');
                document.getElementById('placeholder').classList.add('hidden');
            };
            reader.readAsDataURL(file);
        };

        createBtn.onclick = async () => {
            if (!storedKey) { toggleSettings(); return; }
            const file = fileInput.files[0];
            if (!file) { showStatus("Select a photo first", true); return; }

            setLoading(true);
            const base64 = previewImg.src.split(',')[1];
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${storedKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [
                            { text: "Generate a professional passport-size headshot. Subject wears a black blazer and white shirt. Background: plain solid white. Lighting: bright and even. High resolution, clear facial features, official 2x2 aspect ratio." },
                            { inlineData: { mimeType: file.type, data: base64 } }
                        ]}],
                        generationConfig: { responseModalities: ["IMAGE"] }
                    })
                });

                if (response.status === 403) throw new Error("Invalid API Key");
                const data = await response.json();
                const image = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (image) {
                    document.getElementById('output-img').src = `data:image/png;base64,${image}`;
                    document.getElementById('result-area').classList.remove('hidden');
                    createBtn.classList.add('hidden');
                } else {
                    throw new Error("No image generated. Try a different photo.");
                }
            } catch (err) {
                showStatus(err.message, true);
            } finally {
                setLoading(false);
            }
        };

        document.getElementById('save-btn').onclick = () => {
            const link = document.createElement('a');
            link.href = document.getElementById('output-img').src;
            link.download = 'Passport_AI.png';
            link.click();
        };

        function setLoading(isLoading) {
            createBtn.disabled = isLoading;
            document.getElementById('btn-text').innerHTML = isLoading ? '<div class="flex items-center justify-center gap-2"><div class="loader"></div> Processing</div>' : "Generate Passport Photo";
        }

        function showStatus(msg, isError) {
            status.innerText = msg;
            status.className = `mt-4 p-3 rounded-lg text-[10px] font-bold text-center uppercase tracking-tight ${isError ? 'bg-red-50 text-red-500' : 'bg-emerald-50 text-emerald-600'}`;
            status.classList.remove('hidden');
        }
    </script>
</body>
</html>
