<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passport AI | Minimalist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #111827;
        }
        .app-container {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
        }
        .btn-action {
            background-color: #000000;
            color: #ffffff;
            transition: opacity 0.2s;
        }
        .btn-action:hover {
            opacity: 0.8;
        }
        .upload-box {
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            transition: all 0.2s;
        }
        .upload-box:hover {
            border-color: #000000;
        }
        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #000000;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="max-w-[300px] w-full app-container p-6">
        <!-- Header -->
        <div class="flex items-center gap-2 mb-6">
            <div class="w-7 h-7 bg-black rounded flex items-center justify-center text-white">
                <i class="fas fa-camera text-[10px]"></i>
            </div>
            <h1 class="text-base font-extrabold tracking-tight">Passport AI</h1>
        </div>

        <!-- Upload Section -->
        <div id="upload-zone" class="upload-box h-32 flex flex-col items-center justify-center cursor-pointer mb-4 relative overflow-hidden bg-gray-50">
            <input type="file" id="file-input" class="hidden" accept="image/*">
            <div id="placeholder" class="text-center">
                <i class="fas fa-plus text-gray-300 text-lg mb-1"></i>
                <p class="text-[9px] font-bold text-gray-400 uppercase tracking-wider">Upload Photo</p>
            </div>
            <img id="preview-img" class="hidden absolute inset-0 w-full h-full object-cover rounded-[10px]" alt="Preview">
        </div>

        <!-- Main Button -->
        <button id="create-btn" class="w-full py-3.5 btn-action rounded-xl text-[10px] font-bold uppercase tracking-[0.2em] disabled:opacity-50">
            <span id="btn-text">Generate</span>
        </button>

        <!-- Output Section -->
        <div id="result-area" class="hidden mt-6 pt-6 border-t border-gray-100">
            <div class="flex justify-center mb-5">
                <img id="output-img" class="w-32 h-32 object-cover border border-gray-100 rounded shadow-sm" alt="Result">
            </div>
            <div class="flex gap-2">
                <button id="save-btn" class="flex-1 py-3 bg-emerald-600 text-white rounded-lg text-[9px] font-bold uppercase tracking-wider">
                    Download
                </button>
                <button onclick="window.location.reload()" class="px-4 bg-gray-100 text-gray-400 rounded-lg border border-gray-200">
                    <i class="fas fa-redo text-[10px]"></i>
                </button>
            </div>
        </div>

        <!-- Status/Error -->
        <p id="status" class="hidden mt-3 text-[9px] text-center font-bold uppercase tracking-tight"></p>
    </div>

    <script>
        // Internal API Logic
        const apiKey = "AIzaSyCpZmEKZPkIJ2geSuBs8-uda3a1cmZSVqo"; 
        const modelName = "gemini-2.5-flash-image-preview";

        const fileInput = document.getElementById('file-input');
        const uploadZone = document.getElementById('upload-zone');
        const previewImg = document.getElementById('preview-img');
        const placeholder = document.getElementById('placeholder');
        const createBtn = document.getElementById('create-btn');
        const btnText = document.getElementById('btn-text');
        const resultArea = document.getElementById('result-area');
        const outputImg = document.getElementById('output-img');
        const status = document.getElementById('status');

        let base64Data = null;

        uploadZone.onclick = () => fileInput.click();

        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (ev) => {
                base64Data = ev.target.result.split(',')[1];
                previewImg.src = ev.target.result;
                previewImg.classList.remove('hidden');
                placeholder.classList.add('hidden');
                status.classList.add('hidden');
            };
            reader.readAsDataURL(file);
        };

        createBtn.onclick = async () => {
            if (!base64Data) {
                showStatus("Please select a photo", true);
                return;
            }

            setLoading(true);
            const prompt = "Passport-size photo of a man wearing a black blazer, white shirt, and a solid black tie, strictly following the reference image for facial features and pose. The background must be plain white, clean, and professional. The final output must be in standard passport photo dimensions (2x2 inches or 51x51 mm) with realistic lighting and sharp details, perfect for official use";

            try {
                const result = await callGemini(prompt, base64Data);
                if (result) {
                    outputImg.src = `data:image/png;base64,${result}`;
                    resultArea.classList.remove('hidden');
                    createBtn.classList.add('hidden');
                }
            } catch (err) {
                showStatus("Error: Try Again", true);
            } finally {
                setLoading(false);
            }
        };

        async function callGemini(prompt, base64, retries = 0) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: "image/png", data: base64 } }
                    ]
                }],
                generationConfig: {
                    responseModalities: ["IMAGE"]
                }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    if (retries < 5) {
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(r => setTimeout(r, delay));
                        return callGemini(prompt, base64, retries + 1);
                    }
                    throw new Error("API Limit");
                }

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

            } catch (error) {
                if (retries < 5) {
                    const delay = Math.pow(2, retries) * 1000;
                    await new Promise(r => setTimeout(r, delay));
                    return callGemini(prompt, base64, retries + 1);
                }
                throw error;
            }
        }

        document.getElementById('save-btn').onclick = () => {
            const link = document.createElement('a');
            link.href = outputImg.src;
            link.download = 'passport_ai.png';
            link.click();
        };

        function setLoading(isLoading) {
            createBtn.disabled = isLoading;
            btnText.innerHTML = isLoading ? '<div class="flex items-center justify-center gap-2"><div class="loader"></div> Processing...</div>' : "Generate";
        }

        function showStatus(msg, isError) {
            status.innerText = msg;
            status.className = `mt-3 text-[9px] text-center font-bold uppercase ${isError ? 'text-red-500' : 'text-emerald-600'}`;
            status.classList.remove('hidden');
        }
    </script>
</body>
</html>
